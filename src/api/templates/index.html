<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Junior Web Developer Exercise</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="min-h-screen mx-auto bg-gradient-to-b from-blue-700 to-blue-500">
    <div class="flex flex-col items-center h-full w-full">
      <div class="text-3xl text-center text-white p-4 m-8">Sort Words</div>
      <form
        id="sort-form"
        method="post"
        action="/api/sort"
        class="flex flex-col rounded-2xl bg-white p-4 w-6/12 shadow-lg"
      >
        {% csrf_token %}
        <div class="flex my-4 mx-12 align-center">
          <label for="list" class="text-xl pr-4">Enter one word per line</label>
          <textarea
            name="list"
            id="textarea"
            rows="10"
            class="focus:outline-none focus:ring focus:border-blue-300 bg-gray-200 p-2"
          ></textarea>
        </div>
        <button
          id="submit"
          class="bg-blue-500 hover:bg-blue-700 rounded-xl mx-12 my-4 p-3 text-white shadow-md"
          type="submit"
        >
          Submit
        </button>
      </form>
      <div id="sorted-list" class="rounded-xl p-4 m-4 bg-gray-200 shadow-md" style="min-width: 450px;">
        <div class="text-xl text-center p-4">
          Hit submit to see the words alphabetically sorted....
        </div>
        <ul id="sorted-ul" class="list-disc list-inside p-4">
          <li class="hidden" data-type="template"></li>
        </ul>
      </div>
    </div>

    <script>
      async function fetchData(postData, headers) {
        let sortedListTitleEl = document
          .getElementById("sorted-list")
          .querySelector("div")
        updateText(sortedListTitleEl, "Loading...")
        const data = await fetch("/api/sort/", {
          method: "POST",
          body: JSON.stringify(postData),
          headers: headers,
        })
          .then((response) => {
            return response.json()
          })
        updateText(
          sortedListTitleEl,
          "Here are the words alphabetically sorted..."
        )
        return data
      }

      function populateList(element, list) {
        let templateEl = element.querySelector("li[data-type='template']")
        list.forEach((item) => {
          let li = templateEl.cloneNode()
          li.innerHTML = item
          li.classList.remove("hidden")
          li.removeAttribute("data-type")
          element.appendChild(li)
        })
      }

      function clearLiElements(element) {
        let liElements = element.querySelectorAll(
          "li:not([data-type='template'])"
        )
        liElements.forEach((item) => {
          item.remove()
        })
      }

      function updateText(element, text) {
        element.innerHTML = text
      }

      function disableButton(buttonElement) {
        buttonElement.disabled = true
        buttonElement.classList.add("opacity-50", "cursor-not-allowed")
        buttonElement.classList.remove("hover:bg-blue-700")
      }

      function enableButton(buttonElement) {
        buttonElement.disabled = false
        buttonElement.classList.remove("opacity-50", "cursor-not-allowed")
        buttonElement.classList.add("hover:bg-blue-700")
      }

      const formElement = document.getElementById("sort-form")
      formElement.addEventListener("submit", async (event) => {
        event.preventDefault()
        const textareaElement = document.getElementById("textarea")
        // Create a list of words from the textarea values
        const wordList = textareaElement.value.trim().split("\n")
        // Provide the headers to the request
        const csrfToken = document.querySelector(
          "input[name='csrfmiddlewaretoken']"
        ).value
        const headers = {
          Accept: "application/json",
          "Content-Type": "application/json",
          "X-CSRFToken": csrfToken,
        }
        let button = document.getElementById("submit")
        disableButton(button)
        // Clear the list items from any previous response
        // and then populate with the new items
        let sortedUl = document.getElementById("sorted-ul")
        // Get the data from the API endpoint
        clearLiElements(sortedUl)
        let sortedList = await fetchData(wordList, headers)
        populateList(sortedUl, sortedList)
        enableButton(button)
      })
    </script>
  </body>
</html>
